<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>２０２５年度版新標準メニュー電気料金比較（v3：Excel連携＋託送料金分離）</title>
<style>
  :root{font-family:system-ui,-apple-system,'Hiragino Kaku Gothic ProN',Meiryo,Arial;}
  body{margin:0;padding:18px;background:#f6f7fb;color:#111;}
  h1{margin:0 0 12px;font-size:20px;}
  .grid{display:grid;gap:12px;grid-template-columns:1fr 420px;}
  .card{background:#fff;border-radius:10px;padding:12px;box-shadow:0 2px 8px rgba(20,20,40,0.06);}
  label{display:block;margin-top:8px;font-size:13px;color:#333;}
  input[type="number"], select{width:100%;padding:10px;border:1px solid #dde3ef;border-radius:6px;font-size:16px;}
  .small{font-size:12px;color:#666;}
  button{padding:10px 14px;border-radius:10px;border:none;background:#2563eb;color:white;cursor:pointer;font-size:15px;}
  button.ghost{background:transparent;color:#2563eb;border:1px solid #cfe0ff;}
  .row{display:flex;gap:8px;align-items:center;}
  table{width:100%;border-collapse:collapse;margin-top:12px;}
  th,td{padding:8px;border-bottom:1px solid #eee;text-align:right;font-size:13px;}
  th:first-child, td:first-child{text-align:left;}
  .rightkv{display:grid;grid-template-columns:1fr auto;gap:4px 8px;align-items:center}
  .rightkv .key{color:#333;font-size:13px}
  .rightkv .val{font-variant-numeric:tabular-nums}
  .hl{background:#eff6ff;border:1px solid #dbeafe;border-radius:8px;padding:8px;margin-top:8px}
  .hidden{display:none !important;}
  @media (max-width: 600px) {
    body{padding:12px;}
    .grid{display:flex;flex-direction:column;gap:12px;}
    .row{flex-direction:column;gap:6px;align-items:stretch;}
    button{width:100%;}
    .rightkv{grid-template-columns:1fr;}
    .rightkv .val{text-align:left;word-break:break-word;}
  }
</style>
</head>
<body>
<h1>２０２５年度版新標準メニュー電気料金比較（v3：Excel連携＋託送料金分離）</h1>

<div class="grid">
  <div class="card">
    <div class="small" style="margin-bottom:8px">※ 託送料金は電力量料金に含めず、別欄「託送料金相当額」で表示します。</div>

    <label>現在利用プラン</label>
    <select id="currentPlan">
      <option value="basic">ベーシックプラン</option>
      <option value="zero">市場調整ゼロプラン</option>
      <option value="linked">市場価格連動プラン</option>
    </select>

    <label>検針日</label>
    <select id="meterDay">
      <option value="1">毎月1日</option>
      <option value="2toEnd">毎月2日〜月末</option>
    </select>

    <label>対象年月</label>
    <select id="targetMonth"><option value="2025-04">2025-04</option><option value="2025-05">2025-05</option><option value="2025-06">2025-06</option><option value="2025-07">2025-07</option><option value="2025-08">2025-08</option><option value="2025-09">2025-09</option></select>

    <label>契約電力（kW）</label>
    <input id="contractKW" type="number" min="0" step="0.1" value="50" />

    <div id="monthlyBox" class="hidden">
      <label>月間使用量（kWh） — 市場調整ゼロプラン用</label>
      <input id="useMonthly" type="number" min="0" step="1" value="12000" />
    </div>

    <div id="timebandBox">
      <label>時間帯別使用量（kWh） — ベーシック／市場価格連動プラン用</label>
      <div class="row">
        <input id="useMorning" type="number" placeholder="朝（例：2500）" />
        <input id="useDay" type="number" placeholder="昼（例：3500）" />
      </div>
      <div class="row" style="margin-top:6px">
        <input id="useEvening" type="number" placeholder="晩（例：4000）" />
        <input id="useNight" type="number" placeholder="夜（例：2000）" />
      </div>
    </div>

    <div class="row" style="margin-top:10px;">
      <button id="calcBtn">計算する</button>
      <button id="sampleBtn" class="ghost">サンプル入力</button>
      <button id="resetBtn" class="ghost">リセット</button>
    </div>
  </div>

  <div class="card">
    <h3>単価・付加項目（自動反映／編集不可）</h3>
    <div class="rightkv">
      <div class="key">再エネ賦課金（円/kWh）</div><div class="val" id="reenVal">-</div>
      <div class="key">託送料金平均単価（円/kWh）</div><div class="val" id="tatsusoVal">4.16</div>
    </div>

    <h4>月次単価（自動反映）</h4>
    <div class="rightkv">
      <div class="key">燃料費調整</div><div class="val" id="fuelVal">-</div>
      <div class="key">市場価格調整</div><div class="val" id="marketVal">朝: - / 昼: - / 晩: - / 夜: -</div>
    </div>
  </div>

  <div style="grid-column:1/-1;">
    <div class="card">
      <h3>比較結果</h3>
      <table id="resultTable" style="display:none;">
        <thead>
          <tr>
            <th>プラン</th><th>基本料金</th><th>電力量料金</th><th>再エネ賦課金</th><th>託送料金相当額</th><th>燃料費調整</th><th>市場価格調整</th><th>合計</th>
          </tr>
        </thead>
        <tbody id="resultBody"></tbody>
      </table>
    </div>
  </div>
</div>

<script>
const MONTH_DATA = {
  "2025-04": {
    "fuel": {
      "basic": -0.43,
      "zero": -0.38
    },
    "market_basic": {
      "1": {
        "morning": -0.67,
        "daytime": -0.43,
        "evening": 0.31,
        "night": -0.34
      },
      "2toEnd": {
        "morning": -0.55,
        "daytime": -0.49,
        "evening": 0.43,
        "night": -0.25
      }
    },
    "market_linked": {
      "1": {
        "morning": -4.03,
        "daytime": -2.86,
        "evening": 0.86,
        "night": -2.38
      },
      "2toEnd": {
        "morning": -3.45,
        "daytime": -3.14,
        "evening": 1.44,
        "night": -1.92
      }
    }
  },
  "2025-05": {
    "fuel": {
      "basic": 0.15,
      "zero": 0.18
    },
    "market_basic": {
      "1": {
        "morning": -0.45,
        "daytime": -0.17,
        "evening": 0.3,
        "night": -0.52
      },
      "2toEnd": {
        "morning": -0.67,
        "daytime": -0.43,
        "evening": 0.31,
        "night": -0.34
      }
    },
    "market_linked": {
      "1": {
        "morning": -2.24,
        "daytime": -0.83,
        "evening": 1.48,
        "night": -2.58
      },
      "2toEnd": {
        "morning": -3.33,
        "daytime": -2.16,
        "evening": 1.56,
        "night": -1.68
      }
    }
  },
  "2025-06": {
    "fuel": {
      "basic": -0.06,
      "zero": -0.07
    },
    "market_basic": {
      "1": {
        "morning": -0.19,
        "daytime": 0.58,
        "evening": 0.82,
        "night": -0.24
      },
      "2toEnd": {
        "morning": -0.45,
        "daytime": -0.17,
        "evening": 0.3,
        "night": -0.52
      }
    },
    "market_linked": {
      "1": {
        "morning": -0.95,
        "daytime": 2.9,
        "evening": 4.1,
        "night": -1.21
      },
      "2toEnd": {
        "morning": -2.24,
        "daytime": -0.83,
        "evening": 1.48,
        "night": -2.58
      }
    }
  },
  "2025-07": {
    "fuel": {
      "basic": -0.59,
      "zero": -0.72
    },
    "market_basic": {
      "1": {
        "morning": -0.12,
        "daytime": 1.17,
        "evening": 1.88,
        "night": -0.26
      },
      "2toEnd": {
        "morning": -0.49,
        "daytime": 4.59,
        "evening": 7.39,
        "night": -1.04
      }
    },
    "market_linked": {
      "1": {
        "morning": -0.24,
        "daytime": 0.74,
        "evening": 1.04,
        "night": -0.31
      },
      "2toEnd": {
        "morning": -0.95,
        "daytime": 2.9,
        "evening": 4.1,
        "night": -1.21
      }
    }
  },
  "2025-08": {
    "fuel": {
      "basic": -1.97,
      "zero": -2.18
    },
    "market_basic": {
      "1": {
        "morning": -0.35,
        "daytime": 0.8,
        "evening": 1.38,
        "night": -0.26
      },
      "2toEnd": {
        "morning": -2.37,
        "daytime": 2.14,
        "evening": 4.44,
        "night": -2.02
      }
    },
    "market_linked": {
      "1": {
        "morning": -0.12,
        "daytime": 1.17,
        "evening": 1.88,
        "night": -0.26
      },
      "2toEnd": {
        "morning": -1.49,
        "daytime": 3.59,
        "evening": 6.39,
        "night": -2.04
      }
    }
  },
  "2025-09": {
    "fuel": {
      "basic": -2.42,
      "zero": -2.68
    },
    "market_basic": {
      "1": {
        "morning": -0.2,
        "daytime": 0.83,
        "evening": 1.22,
        "night": -0.4
      },
      "2toEnd": {
        "morning": -1.98,
        "daytime": 2.08,
        "evening": 3.58,
        "night": -2.76
      }
    },
    "market_linked": {
      "1": {
        "morning": -0.35,
        "daytime": 0.8,
        "evening": 1.38,
        "night": -0.26
      },
      "2toEnd": {
        "morning": -2.57,
        "daytime": 1.94,
        "evening": 4.24,
        "night": -2.22
      }
    }
  }
};

// 既知の再エネ賦課金（未定義月は0扱い）
const REENE_BY_MONTH = {"2025-04":3.98,"2025-05":3.98,"2025-06":3.98,"2025-07":3.98,"2025-08":3.98,"2025-09":3.98};
const TATSUSO = 4.16;

const el=id=>document.getElementById(id);
const currentPlan=el('currentPlan'),meterDay=el('meterDay'),targetMonth=el('targetMonth');
const contractKW=el('contractKW'),useMonthly=el('useMonthly'),useMorning=el('useMorning'),useDay=el('useDay'),useEvening=el('useEvening'),useNight=el('useNight');
const reenVal=el('reenVal'),fuelVal=el('fuelVal'),marketVal=el('marketVal'),resultTable=el('resultTable'),resultBody=el('resultBody');

function setHidden(e, h){ e.classList.toggle('hidden', !!h); }
function yen(n){ return (Math.round(n||0)).toLocaleString()+' 円'; }

function updateInputMode(){
  const showMonthly = currentPlan.value==='zero';
  setHidden(el('monthlyBox'), !showMonthly);
  setHidden(el('timebandBox'), showMonthly);
}
currentPlan.addEventListener('change', ()=>{ updateInputMode(); reflectRightPanel(); });
meterDay.addEventListener('change', reflectRightPanel);
targetMonth.addEventListener('change', reflectRightPanel);

function reflectRightPanel(){
  const ymRaw=targetMonth.value; const ym=ymRaw.replace('-', ''); const md=meterDay.value;
  const data = MONTH_DATA[ymRaw] || MONTH_DATA[ym];
  const reen = (RENEE_BY_MONTH[ymRaw] ?? REENE_BY_MONTH[ym] ?? 0);

  reenVal.textContent = (reen!=null ? reen.toFixed(2) : '-');

  if(data && data.fuel){
    fuelVal.textContent = (currentPlan.value==='zero' ? (data.fuel.zero??0) : (data.fuel.basic??0)).toFixed(2);
  } else { fuelVal.textContent='-'; }

  let marketSet = null;
  if(data){
    marketSet = (currentPlan.value==='linked') ? (data.market_linked?.[md]) : (data.market_basic?.[md]);
  }
  if(marketSet){
    marketVal.textContent = `朝: ${(marketSet.morning??0).toFixed(2)} / 昼: ${(marketSet.daytime??0).toFixed(2)} / 晩: ${(marketSet.evening??0).toFixed(2)} / 夜: ${(marketSet.night??0).toFixed(2)}`;
  } else {
    marketVal.textContent = '朝: - / 昼: - / 晩: - / 夜: -';
  }
}

function getUsage(){
  if(currentPlan.value==='zero'){ const total=Number(useMonthly.value||0),q=total/4; return{morning:q,daytime:q,evening:q,night:q,total}; }
  const m=Number(useMorning.value||0),d=Number(useDay.value||0),e=Number(useEvening.value||0),n=Number(useNight.value||0);
  return{morning:m,daytime:d,evening:e,night:n,total:m+d+e+n};
}

function compute(){
  const ymRaw=targetMonth.value; const ym=ymRaw.replace('-', ''); const md=meterDay.value;
  const data = MONTH_DATA[ymRaw] || MONTH_DATA[ym]; if(!data) throw new Error('当月データが見つかりません。');
  const reen=(RENEE_BY_MONTH[ymRaw] ?? REENE_BY_MONTH[ym] ?? 0);
  const usage=getUsage(); const kW=Number(contractKW.value||0);

  const B={basic_per_kw:3030.00, energy_per_kwh:16.56};
  const Z={basic_per_kw:3220.00, energy_per_kwh:16.63};
  const L={basic_per_kw:1500.00, energy_per_kwh_m:16.37, energy_per_kwh_d:16.37, energy_per_kwh_e:16.37, energy_per_kwh_n:16.19};

  const basic_basic=B.basic_per_kw*kW*0.85, basic_zero=Z.basic_per_kw*kW*0.85, basic_link=L.basic_per_kw*kW*0.85;

  const eff_basic=B.energy_per_kwh+reen, eff_zero=Z.energy_per_kwh+reen;
  const eff_link_m=L.energy_per_kwh_m+reen, eff_link_d=L.energy_per_kwh_d+reen, eff_link_e=L.energy_per_kwh_e+reen, eff_link_n=L.energy_per_kwh_n+reen;

  const energy_basic=usage.total*eff_basic;
  const energy_zero=usage.total*eff_zero;
  const energy_link=usage.morning*eff_link_m+usage.daytime*eff_link_d+usage.evening*eff_link_e+usage.night*eff_link_n;

  const reen_basic=usage.total*reen, reen_zero=usage.total*reen, reen_link=usage.total*reen;

  const tatsuso_basic=usage.total*TATSUSO, tatsuso_zero=usage.total*TATSUSO, tatsuso_link=usage.total*TATSUSO;

  const fuel_basic=usage.total*(data.fuel?.basic??0), fuel_zero=usage.total*(data.fuel?.zero??0), fuel_link=0;

  const mb=data.market_basic?.[md]||{morning:0,daytime:0,evening:0,night:0};
  const ml=data.market_linked?.[md]||{morning:0,daytime:0,evening:0,night:0};

  const market_basic=usage.morning*mb.morning+usage.daytime*mb.daytime+usage.evening*mb.evening+usage.night*mb.night;
  const market_zero=0;
  const market_link=usage.morning*ml.morning+usage.daytime*ml.daytime+usage.evening*ml.evening+usage.night*ml.night;

  const total_basic=basic_basic+energy_basic+reen_basic+fuel_basic+market_basic;
  const total_zero=basic_zero+energy_zero+reen_zero+fuel_zero+market_zero;
  const total_link=basic_link+energy_link+reen_link+fuel_link+market_link;

  return{perPlan:[
    {name:"ベーシックプラン", basic:basic_basic, energy:energy_basic, reen:reen_basic, tatsuso:tatsuso_basic, fuel:fuel_basic, market:market_basic, total:total_basic},
    {name:"市場調整ゼロプラン", basic:basic_zero, energy:energy_zero, reen:reen_zero, tatsuso:tatsuso_zero, fuel:fuel_zero, market:market_zero, total:total_zero},
    {name:"市場価格連動プラン", basic:basic_link, energy:energy_link, reen:reen_link, tatsuso:tatsuso_link, fuel:fuel_link, market:market_link, total:total_link}
  ]};
}

function render(model){
  resultBody.innerHTML="";
  for(const p of model.perPlan){
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>$\{p.name}</td><td>$\{yen(p.basic)}</td><td>$\{yen(p.energy)}</td><td>$\{yen(p.reen)}</td><td>$\{yen(p.tatsuso)}</td><td>$\{yen(p.fuel)}</td><td>$\{yen(p.market)}</td><td><strong>$\{yen(p.total)}</strong></td>`;
    resultBody.appendChild(tr);
  }
  resultTable.style.display="";
}

document.getElementById('calcBtn').addEventListener('click', ()=>{ try{const m=compute(); render(m);}catch(e){alert(e.message);} });
document.getElementById('sampleBtn').addEventListener('click', ()=>{ if(currentPlan.value==='zero'){useMonthly.value=12000;} else {useMorning.value=2500;useDay.value=3500;useEvening.value=4000;useNight.value=2000;} });
document.getElementById('resetBtn').addEventListener('click', ()=>{ useMonthly.value='';useMorning.value=useDay.value=useEvening.value=useNight.value=''; resultTable.style.display='none'; });

updateInputMode();
reflectRightPanel();
</script>
</body>
</html>